# Distributed under the terms of the GNU General Public License v2

EAPI=7

inherit go-module linux-info

DESCRIPTION="System container image builder for LXC and LXD"
HOMEPAGE="https://linuxcontainers.org/distrobuilder/introduction/"
SRC_URI="{{artifacts[0].src_uri}}"

LICENSE="Apache-2.0"
SLOT="0"
KEYWORDS="*"

RDEPEND="
	dev-util/debootstrap
	app-crypt/gnupg
	sys-fs/squashfs-tools
	dev-vcs/git
	net-misc/rsync
	"

CONFIG_CHECK="~OVERLAY_FS"
RESTRICT+=" test"

src_compile() {
	cd _dist/src/github.com/lxc/distrobuilder || die "cd failed"
	GO111MODULE="off" GOBIN="${S}/bin" GOPATH="${S}/_dist" \
		go install ./... || die "compile failed"
}

src_install() {
	dobin bin/*
}
